function doGet(e) {
  var rollno = e.parameter.rollno;
  if (!rollno) {
    return ContentService.createTextOutput(JSON.stringify({ error: "Missing rollno parameter" }))
      .setMimeType(ContentService.MimeType.JSON);
  }

  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = ss.getSheetByName("StudentData"); // Update sheet name if needed
  var data = sheet.getDataRange().getValues();
  var headers = data[0];

  // Normalize header keys (case-insensitive)
  var idx = {};
  headers.forEach(function (val, i) {
    idx[val.trim().toLowerCase()] = i;
  });

  let result = null;

  for (let i = 1; i < data.length; i++) {
    let row = data[i];
    if (String(row[idx['id']]).trim() === String(rollno).trim()) {
      result = {
        id: row[idx['id']],
        name: row[idx['name']],
        sem: row[idx['sem']],
        sub1: row[idx['sub1']],
        sec1: row[idx['sec1']],
        sub2: row[idx['sub2']],
        sec2: row[idx['sec2']],
        sub3: row[idx['sub3']],
        sec3: row[idx['sec3']],
        sub4: idx['sub4'] !== undefined ? row[idx['sub4']] : '',
        sec4: idx['sec4'] !== undefined ? row[idx['sec4']] : '',
        sub5: idx['sub5'] !== undefined ? row[idx['sub5']] : '',
        sec5: idx['sec5'] !== undefined ? row[idx['sec5']] : '',
        sub6: idx['sub6'] !== undefined ? row[idx['sub6']] : '',
        sec6: idx['sec6'] !== undefined ? row[idx['sec6']] : '',
        sub7: idx['sub7'] !== undefined ? row[idx['sub7']] : '',
        sec7: idx['sec7'] !== undefined ? row[idx['sec7']] : '',
        sub8: idx['sub8'] !== undefined ? row[idx['sub8']] : '',
        sec8: idx['sec8'] !== undefined ? row[idx['sec8']] : ''
      };
      break;
    }
  }

  var output = result
    ? { found: true, student: result }
    : { found: false, message: "Student not found" };

  Logger.log("Raw Headers: " + headers.join('|'));
  Logger.log("Cleaned Keys: " + Object.keys(idx).join('|'));
  //Logger.log("Data row for matched rollno: " + JSON.stringify(row));
  Logger.log("Index map: " + JSON.stringify(idx));

  Logger.log(JSON.stringify(result));  // Add this line to inspect

  return ContentService.createTextOutput(JSON.stringify(output))
    .setMimeType(ContentService.MimeType.JSON);
}
